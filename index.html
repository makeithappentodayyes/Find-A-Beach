<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">

    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
        integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous" />

    <link href="https://fonts.googleapis.com/css?family=Open+Sans&display=swap" rel="stylesheet" />
    <!-- <link rel="stylesheet" href="style.css" /> -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment-with-locales.min.js"></script>

    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="css/materialize.min.css" media="screen,projection" />
    <link type="text/css" rel="stylesheet" href="./css/style.css" media="screen,projection" />

</head>
<title>Find A Beach</title>
</head>

<body>


    <!-- basic container for displaying a card that decscribes the web site-->

    <div class="container">
        <div class="row">
            <div class="col s6 m12">
                <div class="card blue-grey darken-1" style="width: 100%">
                    <div class="card-content white-text">
                        <span class="card-title">
                            <h3>Find Your Beach</h3>
                            <p>Search for the 5 Closest Beaches based on your current location.<br>Current Day Weather
                                Forecast, Directions, and more.</p>
                        </span>
                    </div>
                    <div class="card-action">
                        <a class="waves-effect waves-light btn-large" id="btnSearch"><i
                                class="material-icons left">beach_access</i>Find
                            Beaches</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="row">
                <div class="col s6 m12">
                    <ul class="collapsible">
                        <li id="beach_0">
                            <div class="collapsible-header" id="bName_0"><i class="material-icons">beach_access</i>
                            </div>
                            <div class="collapsible-body" id="_0">

                                <div class="row">
                                    <div class="col s6 m12"></div>
                                    <span id="bForecast_0"></span>
                                        <div class="notification"></div>

                                        <div class="weather-container">
                                            <div class="weather-icon">
                                                <img src="icons/unknown.png" alt="" />
                                            </div>

                                            <div class="temperature-value">
                                                <p>- Â°<span>C</span></p>
                                            </div>

                                            <div class="the-temperature">
                                                <p>-</p>
                                            </div>

                                            <div class="location">
                                                <p>-</p>
                                            </div>
                                        </div>
                                </div>

                                <div class="row">
                                    <div class="col s6 m12"></div>
                                    <img src="https://www.coastal.ca.gov/access-photos/16_san_diego/07_Solana_Beach_to_Del_Mar/Del_Mar_City_Beach_access_at_17th_Street_2013_09_27_7792.jpg"
                                        width="80%" id="bImage_0">
                                </div>
                                <div class="row">
                                    <div class="col s6 m12 googleMapWindow" id="map0">&nbsp;</div>
                                </div>
                        </li>
                        <li id="beach_1">
                            <div class="collapsible-header" id="bName_1"><i class="material-icons">beach_access</i>
                            </div>
                            <div class="collapsible-body" id="_1">
                                <div class="row">
                                    <div class="col s6 m12"></div>
                                    <img src="https://www.coastal.ca.gov/access-photos/16_san_diego/07_Solana_Beach_to_Del_Mar/Powerhouse_Park_2013_09_27_7801.jpg"
                                        width="80%" id="bImage_1">
                                </div>
                                <div class="row">
                                    <div class="col s6 m12 googleMapWindow" id="map1">&nbsp;</div>
                                </div>
                            </div>
                        </li>
                        <li id="beach_2">
                            <div class="collapsible-header" id="bName_2"><i class="material-icons">beach_access</i>Third
                            </div>
                            <div class="collapsible-body" id="_2">
                                <div class="row">
                                    <div class="col s6 m12"></div>
                                    <img src="https://www.coastal.ca.gov/access-photos/16_san_diego/08_Torrey_Pines/Torrey_Pines_State_Beach_2013_09_27_7807.jpg"
                                        width="80%" id="bImage_2">
                                </div>
                                <div class="row">
                                    <div class="col s6 m12 googleMapWindow" id="map2">&nbsp;</div>
                                </div>
                            </div>
                        </li>
                        <li id="beach_3">
                            <div class="collapsible-header" id="bName_3"><i
                                    class="material-icons">beach_access</i>Fourth</div>
                            <div class="collapsible-body" id="_3">
                                <div class="row">
                                    <div class="col s6 m12"></div>
                                    <img src="https://www.coastal.ca.gov/access-photos/16_san_diego/09_Torrey_Pines_City_Beach_to_La_Jolla/Torrey_Pines_City_Beach_accessway_off_La_Jolla_Farms_Road_2007_09_19_0010.jpg"
                                        width="80%" id="bImage_3">
                                </div>
                                <div class="row">
                                    <div class="col s6 m12 googleMapWindow" id="map3">&nbsp;</div>
                                </div>
                            </div>
                        </li>
                        <li id="beach_4">
                            <div class="collapsible-header" id="bName_4"><i class="material-icons">beach_access</i>Fifth
                            </div>
                            <div class="collapsible-body" id="_4">
                                <div class="row">
                                    <div class="col s6 m12"></div>
                                    <img src="https://www.coastal.ca.gov/access-photos/16_san_diego/09_Torrey_Pines_City_Beach_to_La_Jolla/La_Jolla_Shores_Beach_2013_09_27_7826.jpg"
                                        width="80%" id="bImage_4">
                                </div>
                                <div class="row">
                                    <div class="col s6 m12 googleMapWindow" id="map4">&nbsp;</div>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script async
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB1dWx5WfOrU-fvzGEqTL0wY18nVzIgfsU&callback=initMap">
    </script>

    <script>
        //these variables are set to test values for mockup purposes only
        // var bLATTITUDE = 33.147743;
        // var bLONGITUDE = -117.346371;       



        // var bNameMobileWeb = "Carlsbad State Beach";
        // var bPhoto_1 =
        // "https://www.coastal.ca.gov/access-photos/16_san_diego/04_Carlsbad/Carlsbad_State_Beach_near_Juniper_Avenue_2013_09_27_7632.jpg";

        // begin Alvin insertion of code 

        // Alvin Revilas' Google API key:  AIzaSyB1dWx5WfOrU-fvzGEqTL0wY18nVzIgfsU 

        // some starting variables for processing locations of beaches 

        // reference to our beach locator API 
        // var beachQueryURL = "https://api.coastal.ca.gov/access/v1/locations";

        // default searching magnitude with a scaling value to make a rectangle that would be closer in area to a search radius.  
        var inputDist = 5.0; // relative distance in miles.  Default value.  
        var searchDist = 0.75 * inputDist; // estimating too large simple square into better smaller square search area 

        var longitudePerMile =
            0.01462; // estimated conversion constant for California. Conversion constant should be smaller closer to equator, larger closer to North Pole 
        var latitudePerMile =
            0.0145; // estimated conversion constant, rounded up.  This does NOT change due to this dimension being center point based, not axis based like longitude 

        var userLatRaw; // raw latitude data from user 
        var userLongRaw; // raw longitude data from user 

        var userNorthLatBorder = userLatRaw + (searchDist * latitudePerMile); // north border of search area 
        var userSouthLatBorder = userLatRaw - (searchDist * latitudePerMile); // south border of search area 

        var userEastLongBorder = userLongRaw - (searchDist * longitudePerMile); // east border of search area 
        var userWestLongBorder = userLongRaw + (searchDist * longitudePerMile); // west border of search area 

        var boolFoundBeach = false; // boolean flag to signal if a beach was found with given parameters 

        var maxBeaches = 5;
        var lengthArrNearbyBeaches;
        var i = 0; //set index to zero 

        // tempCoords take bLATTITUDE and bLONGITUDE & creates new beachCoords

        function beachCoords(lat, lng) {
            this.lat = lat,
                this.lng = lng;
        }

        function initMap() {

            // example 
            // var searchGearLoc = {
            //     lat: 32.8916087,
            //     lng: -117.1520858
            // }; // The location of Search Gear
            // var searchGearId = "map1";
            // var searchGearMap;
            // var searchGearMarker;

            // makeMap(searchGearLoc, searchGearId, searchGearMap, searchGearMarker);

            // now let's use local variables
            // var bLATTITUDEtmp = localStorage.getItem("myLat_0");
            // var bLONGITUDEtmp = localStorage.getItem("myLong_0");
            // var bLATTITUDE = parseInt(bLATTITUDEtmp);
            // var bLONGITUDE = parseInt(bLONGITUDEtmp);
            // var myLoc = {
            //     lat: bLATTITUDEtmp,
            //     lng: bLONGITUDEtmp
            // }
            // var myDivEl = "map0"
            // var searchMap;
            // var searchMarker;


            // makeMap(myLoc, myDivEl, searchMap, searchMarker);


            // console.log("bLATT and bLONG = " + bLATTITUDEtmp + " and " + bLONGITUDEtmp)
            // console.log("bLATT and bLONG parseInt = " + bLATTITUDE + " and " + bLONGITUDE)
            // new - The map, now centered on tmpCoords 

            // Div Element #map0
            var tmpBeachName = localStorage.getItem("bName_0");
            var beachNameEl = $("#bName_0")
            beachNameEl.text(tmpBeachName)
            var bLATTITUDE = parseFloat(localStorage.getItem("myLat_0"));
            var bLONGITUDE = parseFloat(localStorage.getItem("myLong_0"));
            var tmpCoords = new beachCoords(bLATTITUDE, bLONGITUDE);

            var map = new google.maps.Map(
                document.getElementById("map" + 0), {
                    zoom: 8,
                    center: tmpCoords
                }
            );
            // The marker, now positioned at map0 tmpCoords
            var marker = new google.maps.Marker({
                position: tmpCoords,
                map: map
            });

            // Div Element #map1
            tmpBeachName = localStorage.getItem("bName_1");
            beachNameEl = $("#bName_1")
            beachNameEl.text(tmpBeachName)
            var bLATTITUDE = parseFloat(localStorage.getItem("myLat_1"));
            var bLONGITUDE = parseFloat(localStorage.getItem("myLong_1"));
            var tmpCoords = new beachCoords(bLATTITUDE, bLONGITUDE);

            var map = new google.maps.Map(
                document.getElementById("map" + 1), {
                    zoom: 8,
                    center: tmpCoords
                }
            );

            // The marker, now positioned at map1 tmpCoords
            var marker = new google.maps.Marker({
                position: tmpCoords,
                map: map
            });

            // Div Element #map2
            tmpBeachName = localStorage.getItem("bName_2");
            beachNameEl = $("#bName_2")
            beachNameEl.text(tmpBeachName)
            var bLATTITUDE = parseFloat(localStorage.getItem("myLat_2"));
            var bLONGITUDE = parseFloat(localStorage.getItem("myLong_2"));
            var tmpCoords = new beachCoords(bLATTITUDE, bLONGITUDE);

            var map = new google.maps.Map(
                document.getElementById("map" + 2), {
                    zoom: 8,
                    center: tmpCoords
                }
            );

            // The marker, now positioned at map2 tmpCoords
            var marker = new google.maps.Marker({
                position: tmpCoords,
                map: map
            });

            // Div Element #map3
            tmpBeachName = localStorage.getItem("bName_3");
            beachNameEl = $("#bName_3")
            beachNameEl.text(tmpBeachName)
            var bLATTITUDE = parseFloat(localStorage.getItem("myLat_3"));
            var bLONGITUDE = parseFloat(localStorage.getItem("myLong_3"));
            var tmpCoords = new beachCoords(bLATTITUDE, bLONGITUDE);

            var map = new google.maps.Map(
                document.getElementById("map" + 3), {
                    zoom: 8,
                    center: tmpCoords
                }
            );

            // The marker, now positioned at map3 tmpCoords
            var marker = new google.maps.Marker({
                position: tmpCoords,
                map: map
            });

            // Div Element #map4
            tmpBeachName = localStorage.getItem("bName_4");
            beachNameEl = $("#bName_4")
            beachNameEl.text(tmpBeachName)
            var bLATTITUDE = parseFloat(localStorage.getItem("myLat_4"));
            var bLONGITUDE = parseFloat(localStorage.getItem("myLong_4"));
            var tmpCoords = new beachCoords(bLATTITUDE, bLONGITUDE);

            var map = new google.maps.Map(
                document.getElementById("map" + 4), {
                    zoom: 8,
                    center: tmpCoords
                }
            );

            // The marker, now positioned at map4 tmpCoords
            var marker = new google.maps.Marker({
                position: tmpCoords,
                map: map
            });

        }


        var arrMyCaliBeaches = new Array; // prep array for the incoming objects 
        var tmpBeach; // temporary holding variable for beaches 
        var arrNearbyBeaches = new Array; // array to hold possible valid search results 

        // end Alvin insertion of code 

        // function makeMap(locLatLng, myMapId, myMapActual, myMapMarker) {

        /* 
        Below variables are passed from the initMap() function.  
        Each block of variables are roughly named after the location they reference, as a prefix.  
        These prefixing locations are UCSD Extension, my work "Search Gear", and Sunset Cliffs.  
        Yes, we have beach data for Sunset Cliffs in the allCaliBeaches.js file!!  
        
        locLatLng is an object variable that stores a "lat" data member and a "lng" data member  
        myMapId is a variable that references a div id that will contain a Google map 
        myMapActual is a variable that is the actual map object 
        myMapMarker is a variable that will reference the above map 
        
        This sample html file does NOT reference our *.js files, just because I am trying to simply 
        show how the id referencing in the HTML elements get cross referenced in the sample and 
        simple Javascript.  

        The principles shown should be transferable to our project.  Main one should be that inside 
        function initMap (), we should be invoking a generic function makeMap (), in order to make a 
        separate map per named map div.  
        
        We can do one time variables per individual div for now.  We can talk about variable naming 
        refinement as a possible "to do" for future versions.  
        
        */

        //     myMapActual = new google.maps.Map(
        //         document.getElementById(myMapId), {
        //             zoom: 12,
        //             center: tmpCoords
        //         }
        //     );

        //     myMapMarker = new google.maps.Marker({
        //         position: tmpCoords,
        //         map: myMapActual
        //     });

        // }



        $(document).ready(function () {
            $('.collapsible').collapsible();

            var options = {
                enableHighAccuracy: true,
                timeout: 5000,
                maximumAge: 0
            };

            //if getcurrentposition is successful then get the coords and save the key:value pair    
            function success(pos) {
                var userLoc = pos.coords;
                console.log('Your current position is:');
                console.log(`Latitude_Evelyn : ${userLoc.latitude}`);
                console.log(`Longitude_Evelyn : ${userLoc.longitude}`);
                console.log(`More or less ${userLoc.accuracy} meters.`);
                //set local storage key:value pair for my current lat and long using geolocate api
                localStorage.setItem("myLat", userLoc.latitude)
                localStorage.setItem("myLong", userLoc.longitude)
            }
            //if getcurrentposition is not successful return an error message
            async function error(err) {
                console.warn(`ERROR(${err.code}): ${err.message}`);
            }

            //on click event for search call get lat and long
            $("#btnSearch").on("click", function () {
                navigator.geolocation.getCurrentPosition(success, error, options);
            })

        });
    </script>

    <!--JavaScript at end of body for optimized loading-->
    <script type="text/javascript" src="js/materialize.min.js"></script>
    <script type="text/javascript" src="js/allCaliBeaches.js"></script>
    <script type="text/javascript" src="js/beachProcessor.js"></script>
    <!-- <script type="text/javascript" src="app.js"></script> -->
</body>

</html>