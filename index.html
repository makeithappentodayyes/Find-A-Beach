<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">

    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous" />

    <link href="https://fonts.googleapis.com/css?family=Open+Sans&display=swap" rel="stylesheet" />
    <!-- <link rel="stylesheet" href="style.css" /> -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment-with-locales.min.js"></script>

    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="css/materialize.min.css" media="screen,projection" />
    <link type="text/css" rel="stylesheet" href="./css/style.css" media="screen,projection" />

</head>
<title>Find A Beach</title>
</head>

<body>


    <!-- basic container for displaying a card that decscribes the web site-->

    <div class="container">
        <div class="row">

            <div class="col s6 m12">

                <div class="card blue-grey darken-1" style="width: 100%">

                    <div class="card-content white-text">
                        <span class="card-title">
                            <h3>Find Your Beach</h3>
                            <p>Search for the 5 Closest Beaches based on your current location.<br>Current Day Weather
                                Forecast, Directions, and more.</p>
                        </span>
                    </div>
                    <div class="card-action">
                        <a class="waves-effect waves-light btn-large" id="btnSearch"><i
                                class="material-icons left">beach_access</i>Find
                            Beaches</a>
                    </div>

                </div>

            </div>

        </div>

        <!-- this is a demo section for accordian collapsible-->
        <div class="section">
            <div class="row">
                <div class="col s6 m12">
                    <ul class="collapsible">
                        <li id="beach_0">
                            <div class="collapsible-header" id="bName_0"><i class="material-icons">beach_access</i>Carlsbad State Beach
                            </div>
                            <div class="collapsible-body" id="_0">

                                <div class="row">
                                    <div class="col s6 m12"></div>
                                    <span id="bForecast_0">
                                        <!-- <h5>Forecast</h5> -->
                                
                                    </span>
                                    <div class="location h6" >
                                        <h3 class= "location-timezone">Timezone</h3>
                                        <canvas class="icon" width="128" height="128"></canvas>
                                        </div>
                                        <div class="temperature">
                                            <h2 class="temperature-degree ">22</h2> 
                                            <span>F</span>
                                            <div class="temperature-description">cold or cold</div>
                                        </div>
                                   
                                    <!-- <img src="./images/weathertestimage.png" width="80%"> -->
                                </div>

                                <div class="row">
                                    <div class="col s6 m12"></div>
                                    <span>
                                        <h5>Picture</h5>
                                    </span>
                                    <img src="https://www.coastal.ca.gov/access-photos/16_san_diego/04_Carlsbad/Carlsbad_State_Beach_near_Juniper_Avenue_2013_09_27_7632.jpg" width="80%" id="bImage_0">
                                </div>

                                <div class="row">
                                    <div class="col s6 m12" id="map"></div>
									
                                </div>
                        </li>
                        <li id="beach_1">
                            <div class="collapsible-header" id="bName_1"><i class="material-icons">beach_access</i>Second</div>
                            <div class="collapsible-body" id="_1"><span>Lorem ipsum dolor sit amet.</span></div>
                        </li>
                        <li id="beach_2">
                            <div class="collapsible-header" id="bName_2"><i class="material-icons">beach_access</i>Third</div>
                            <div class="collapsible-body" id="_2"><span>Lorem ipsum dolor sit amet.</span></div>
                        </li>
                        <li id="beach_3">
                            <div class="collapsible-header" id="bName_3"><i class="material-icons">beach_access</i>Fourth</div>
                            <div class="collapsible-body" id="_3"><span>Lorem ipsum dolor sit amet.</span></div>
                        </li>
                        <li id="beach_4">
                            <div class="collapsible-header" id="bName_4"><i class="material-icons">beach_access</i>Fifth</div>
                            <div class="collapsible-body" id="_4"><span>Lorem ipsum dolor sit amet.</span></div>
                        </li>
                    </ul>
                    </div>
                </div>
            </div>
        </div>

        <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB1dWx5WfOrU-fvzGEqTL0wY18nVzIgfsU&callback=initMap"></script>

        <script>
            //these variables are set to test values for mockup purposes only
            var bLATTITUDE = 33.147743;
            var bLONGITUDE = -117.346371;
            var bNameMobileWeb = "Carlsbad State Beach";
            var bPhoto_1 =
                "https://www.coastal.ca.gov/access-photos/16_san_diego/04_Carlsbad/Carlsbad_State_Beach_near_Juniper_Avenue_2013_09_27_7632.jpg";

            // begin Alvin insertion of code 

            // Alvin Revilas' Google API key:  AIzaSyB1dWx5WfOrU-fvzGEqTL0wY18nVzIgfsU 

            // some starting variables for processing locations of beaches 

            // reference to our beach locator API 
            var beachQueryURL = "https://api.coastal.ca.gov/access/v1/locations";

            // default searching magnitude with a scaling value to make a rectangle that would be closer in area to a search radius.  
            var inputDist = 5.0; // relative distance in miles.  Default value.  
            var searchDist = 0.75 * inputDist; // estimating too large simple square into better smaller square search area 

            var longitudePerMile = 0.01462; // estimated conversion constant for California. Conversion constant should be smaller closer to equator, larger closer to North Pole 
            var latitudePerMile = 0.0145; // estimated conversion constant, rounded up.  This does NOT change due to this dimension being center point based, not axis based like longitude 

            var userLatRaw; // raw latitude data from user 
            var userLongRaw; // raw longitude data from user 

            var userNorthLatBorder = userLatRaw + (searchDist * latitudePerMile); // north border of search area 
            var userSouthLatBorder = userLatRaw - (searchDist * latitudePerMile); // south border of search area 

            var userEastLongBorder = userLongRaw - (searchDist * longitudePerMile); // east border of search area 
            var userWestLongBorder = userLongRaw + (searchDist * longitudePerMile); // west border of search area 

            var boolFoundBeach = false; // boolean flag to signal if a beach was found with given parameters 

            var maxBeaches = 5;
            var lengthArrNearbyBeaches;

            // 32.7267928,-117.020472

            function beachCoords(lat, lng) {
                this.lat = lat,
                    this.lng = lng;
            }

            var bLATTITUDE = 33.147743;
            var bLONGITUDE = -117.346371;

            var tmpCoords = new beachCoords(bLATTITUDE, bLONGITUDE);

            function initMap() {

                // new - The map, now centered on tmpCoords 
                var map = new google.maps.Map(

                    document.getElementById("map"), {
                        zoom: 8,
                        center: tmpCoords
                    }

                );

                // The marker, now positioned at tmpCoords
                var marker = new google.maps.Marker({
                    position: tmpCoords,
                    map: map
                });

            }

            // object constructor for Cali beach object.  
            function myCaliBeachObj(
                bID,
                bNameMobileWeb,
                bLATITUDE,
                bLONGITUDE,
                bPhoto_1) {

                this.bID = bID;
                this.bNameMobileWeb = bNameMobileWeb;
                this.bLATITUDE = bLATITUDE;
                this.bLONGITUDE = bLONGITUDE;
                this.bPhoto_1 = bPhoto_1;

            }

            var arrMyCaliBeaches = new Array; // prep array for the incoming objects 
            var tmpBeach; // temporary holding variable for beaches 

            var arrNearbyBeaches = new Array; // array to hold possible valid search results 

            // do the francis-ajax call to Coastal Cal Gov for the beaches API that will populate a possible beaches array 
            function getListAllCaliBeaches() {
                $.ajax({
                    url: beachQueryURL,
                    method: "GET"
                }).then(function(response) {

                    console.log(response); // need to see if response has data! 

                    for (i in response) {

                        tmpBeach = myCaliBeachObj(
                            response[i].ID,
                            response[i].NameMobileWeb,
                            response[i].LATITUDE,
                            response[i].LONGITUDE,
                            response[i].Photo_1
                        );

                        arrMyCaliBeaches.push(tmpBeach);

                        /* 
                        if ( i == 1425 ) { 
                        	console.log( "Index 1425 beach name: " + tmpBeach.bNameMobileWeb ); 
                        	console.log( "Latitude: " + tmpBeach.bLATITUDE ); 
                        	console.log( "Longitude: " + tmpBeach.bLONGITUDE ); 
                        } 
                        */

                    }

                });
            }

            // now populate full array of California beaches 
            getListAllCaliBeaches();

            /*
            This function, named "isBeachInsideSearchBorders", attempts to find a set of latitude and longitude coordinates inside a rectangular search area.  
            The rectangular search area borders are determined by the following:  
		
            North border:  Latitude value 
            South border:  Latitude value 
            East border:   Longitude value 
            West border:   Longitude value 
		
            This function returns a boolean true or false.  
            */

            /* returns a boolean value */
            function isBeachInsideSearchBorders(
                northLatBrdr,
                southLatBrdr,
                eastLngBrdr,
                westLngBrdr,
                bchLat,
                bchLong) {

                if (bchLat <= northLatBrdr) { // check if below North border; possible true if this passes 
                    if (bchLat >= southLatBrdr) { // check if above South border; possible true if this passes 
                        if (bchLong >= westLngBrdr) { // check if east of the west border; possible true if this passes;     going west of Greenwich Mean goes negative 
                            if (bchLong <= eastLngBrdr) { // check if west of the east border; definite true if this passes!!  ; going west of Greenwich Mean goes negative 

                                return true; // the ONLY result that should return true because all border tests have passed!!  

                            } else {
                                return false;
                            }
                        } else {
                            return false;
                        }
                    } else {
                        return false;
                    }
                } else {
                    return false;
                }

            }

            // end Alvin insertion of code 

            $(document).ready(function() {
                $('.collapsible').collapsible();

                var options = {
                    enableHighAccuracy: true,
                    timeout: 5000,
                    maximumAge: 0
                };

                //if getcurrentposition is successful then get the coords and save the key:value pair    
                function success(pos) {
                    var userLoc = pos.coords;
                    console.log('Your current position is:');
                    console.log(`Latitude_Evelyn : ${userLoc.latitude}`);
                    console.log(`Longitude_Evelyn : ${userLoc.longitude}`);
                    console.log(`More or less ${userLoc.accuracy} meters.`);
                    //set local storage key:value pair for my current lat and long using geolocate api
                    localStorage.setItem("myLat", userLoc.latitude)
                    localStorage.setItem("myLong", userLoc.longitude)
                }
                //if getcurrentposition is not successful return an error message
                async function error(err) {
                    console.warn(`ERROR(${err.code}): ${err.message}`);
                }

                //on click event for search call get lat and long
                $("#btnSearch").on("click", function() {
                    navigator.geolocation.getCurrentPosition(success, error, options);
                })


            });
        </script>

        <!--JavaScript at end of body for optimized loading-->
        <script type="text/javascript" src="js/materialize.min.js"></script>
        <script src="weatherpart/skycons.js"></script> 
        <script src="weatherpart/app.js"></script>
</body>

</html>